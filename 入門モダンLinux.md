# 1 Linuxの入門

# 2 Linuxカーネル

システムコール: ユーザプログラムからOSの機能を利用するためのインターフェース

カーネルはモノリシック

主なコンポーネントは

* プロセス管理
* メモリ管理
* ファイルシステム
* ネットワーク
* デバイスドライバ

## プロセス管理

次のような概念がある

* セッション
  * 複数のプロセスグループを含む。ttyを持つ。SIDで識別
* プロセスグループ
  * 複数のプロセスを含む。PGIDで識別
* プロセス
  * プログラムの実行に必要なリソースをグループ化したもの
* スレッド
  * カーネルではプロセスと同じ扱い
* タスク
  * スケジューリング関連の情報PIDなど,nice値などを持つ

## メモリ管理

物理メモリ、仮想メモリともにチャンクに分割されている

プロセスごとにページテーブルがあり、仮想アドレスと物理アドレスの対応を管理する

オーバーコミットにより物理メモリサイズ以上のメモリ確保が可能で、物理メモリ領域の割当は遅延して行われる

仮想アドレスと物理アドレスの対応はTLBにキャッシュされる

Hugepage: ページサイズを大きくすることでTLBのヒット率を上げる

## ネットワーク

* ソケット：通信を抽象化したもの
* TCP/UDP
* IP

カーネルが提供するのは上記のみ

## ファイルシステム

ext4,btrfs,etc...

VFS: ファイルシステムを抽象化して異なるファイルシステムが共存できるように導入されている

## デバイスドライバ

キーボード、マウス、HDDなどのハードウェア、/dev/pts配下の仮想デバイスを制御

`ls -al /sys/devices`でシステム上のデバイスが確認可能

## システムコール

glibcなどがラッパーライブラリ

カーネルモードとユーザ空間の切り替えはコストがかかる

`strace`で確認可能

## カーネルの拡張

### モジュール

必要に応じてカーネルにロードできるプログラム

ハードウェアを自動検出して自動的にロードしてくれることがほとんど

手動でモジュールを読み込みたいときは、ベンダが提供しているモジュールを読み込むなど

ロードしているモジュールは`lsmod`で確認可能

### eBPF

カーネル機能を拡張する手段

セキュリティコントロール、ネットワークロードバランシングなどで利用されている
